{% extends 'layout.html' %}{% block content %}
<div class="d-flex justify-content-between mb-3"><h4>Patients</h4><a class="btn btn-success" href="{{ url_for('add_patient') }}">Add Patient</a></div>
<table class="table"><thead><tr><th>ID</th><th>Name</th><th>Phone</th><th>Age</th><th>Diagnosis</th><th>Actions</th></tr></thead><tbody>{% for p in patients %}<tr><td>{{ p.id }}</td><td>{{ p.name }}</td><td>{{ p.phone }}</td><td>{{ p.age }}</td><td>{{ p.diagnosis }}</td><td><button class="btn btn-info btn-sm" onclick="openPatient({{ p.id }})">View</button> <a class="btn btn-warning btn-sm" href="{{ url_for('edit_patient', id=p.id) }}">Edit</a><form method="post" action="{{ url_for('delete_patient', id=p.id) }}" style="display:inline;"><button class="btn btn-danger btn-sm" onclick="return confirm('Delete?')">Delete</button></form></td></tr>{% endfor %}</tbody></table>
<!-- modal -->
<div class="modal fade" id="patientModal" tabindex="-1"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><h5 id="patientTitle"></h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body" id="patientBody">Loading...</div></div></div></div>
<script>
function openPatient(id){fetch('/api/patient/'+id).then(r=>r.json()).then(d=>{document.getElementById('patientTitle').innerText=d.name; let html='<p><strong>Phone:</strong>'+ (d.phone||'-') +'</p><p><strong>Email:</strong>'+ (d.email||'-') +'</p><p><strong>Address:</strong>'+ (d.address||'-') +'</p>'; html+='<h6>Appointments</h6>'; if(d.appointments.length){html+='<ul>'; d.appointments.forEach(a=>{html+='<li>'+a.date+' '+a.time+' - '+a.doctor+'</li>'}); html+='</ul>';} else html+='<p class="small">No appointments</p>'; html+='<h6>Bills</h6>'; if(d.bills.length){html+='<ul>'; d.bills.forEach(b=>{html+='<li>'+b.date+' - Ksh '+b.amount+' ('+b.status+')</li>'}); html+='</ul>';} else html+='<p class="small">No bills</p>'; document.getElementById('patientBody').innerHTML=html; new bootstrap.Modal(document.getElementById('patientModal')).show();});}
</script>
{% endblock %}
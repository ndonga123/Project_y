{% extends 'layout.html' %}
{% block content %}
<style>
    .top-buttons {
        position: sticky;
        top: 1rem;
        z-index: 1000;
    }
    .stat-card {
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        padding: 20px;
        text-align: center;
    }
    .brand-card {
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
</style>

<div class="dashboard-wrapper">

  <!-- Header row -->
  <div class="header-row mb-4 d-flex justify-content-between align-items-center position-relative">
    <div>
      <h3 class="page-title">Welcome to <span class="brand">Lyncrest Medical Center</span></h3>
      <p class="text-muted small">Simple, secure patient management.</p>
    </div>
    <div class="d-flex align-items-center top-buttons">
      <img src="{{ url_for('static', filename='logo.png') }}" alt="Lyncrest" class="dashboard-logo me-3">
      <div>
        <a href="{{ url_for('patients') }}" class="btn btn-outline-primary btn-sm me-1">
          <i class="bi bi-person-plus"></i> Patients
        </a>
        <a href="{{ url_for('appointments') }}" class="btn btn-outline-success btn-sm me-1">
          <i class="bi bi-calendar"></i> Appointments
        </a>
        <a href="{{ url_for('billing') }}" class="btn btn-outline-info btn-sm">
          <i class="bi bi-cash-stack"></i> Billing
        </a>
      </div>
    </div>
  </div>

  <!-- Stats row -->
  <div class="row g-4">
    <div class="col-md-3">
      <div class="stat-card">
        <small class="muted">Total Patients</small>
        <div class="stat-number text-primary">{{ total_patients }}</div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="stat-card">
        <small class="muted">Appointments</small>
        <div class="stat-number text-success">{{ total_appointments }}</div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="stat-card">
        <small class="muted">Unpaid Bills</small>
        <div class="stat-number text-danger">{{ unpaid_bills }}</div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="stat-card">
        <small class="muted">Billing (Ksh)</small>
        <div class="stat-number text-primary">Ksh {{ total_billing }}</div>
      </div>
    </div>
  </div>

  <!-- Main content -->
  <div class="row mt-4 g-4">
    <div class="col-lg-7">
      <div class="card p-4 brand-card mb-4">
        <div class="d-flex align-items-center">
          <img src="{{ url_for('static', filename='logo.png') }}" alt="Lyncrest logo" class="brand-large me-4">
          <div>
            <h4 class="mb-1">Lyncrest Medical Center</h4>
            <p class="text-muted mb-0">Delivering trusted healthcare. Manage patients, appointments, and billing in one place.</p>
          </div>
        </div>
      </div>

      <!-- Recent appointments -->
      <div class="card p-3">
        <h6>Recent Appointments</h6>
        {% if recent_appointments %}
          <ul class="list-group list-group-flush">
            {% for a in recent_appointments %}
              <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                  <strong>{{ a.patient.name }}</strong> — {{ a.doctor }}
                  <br><small class="text-muted">{{ a.date }} at {{ a.time }}</small>
                </div>
                <span class="badge bg-primary">{{ a.status }}</span>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="small text-muted mb-0">No recent appointments.</p>
        {% endif %}
      </div>
    </div>

    <div class="col-lg-5">
      <!-- Recent bills -->
      <div class="card p-3 mb-4">
        <h6>Recent Bills</h6>
        {% if recent_bills %}
          <ul class="list-group list-group-flush">
            {% for b in recent_bills %}
              <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                  <strong>{{ b.patient.name }}</strong><br>
                  <small>KES {{ "%.2f"|format(b.amount) }} • {{ b.payment_method or 'Pending' }}</small>
                </div>
                {% if b.status == 'Paid' %}
                  <span class="badge bg-success">Paid</span>
                {% else %}
                  <span class="badge bg-warning text-dark">Pending</span>
                {% endif %}
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="small text-muted mb-0">No recent bills.</p>
        {% endif %}
      </div>

      <!-- Notifications -->
      <div class="card p-3">
        <h6>Notifications</h6>
        {% if notifications %}
          <ul class="list-unstyled mb-0">
            {% for note in notifications %}
              <li class="py-2 border-bottom small">
                <strong>{{ note.message }}</strong>
                <div class="text-muted small">{{ note.time }}</div>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="small text-muted mb-0">No new notifications.</p>
        {% endif %}
      </div>
    </div>
  </div>

</div>
{% endblock %}
